<div class="modal-overlay" *ngIf="show" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ mode === 'add' ? 'Thêm danh mục mới' : 'Sửa danh mục' }}</h3>
      <button class="btn-close" (click)="onClose()">
        <fa-icon [icon]="faXmark"></fa-icon>
      </button>
    </div>

    <div class="modal-body">
      <form #categoryForm="ngForm">
        <!-- Tên danh mục -->
        <div class="form-group">
          <label>Tên danh mục <span class="required">*</span></label>
          <input type="text" [(ngModel)]="category.name" name="name" class="form-control" (blur)="generateSlug()"
            required placeholder="Nhập tên danh mục" />
        </div>

        <!-- Slug -->
        <div class="form-group">
          <label>Slug <span class="required">*</span></label>
          <input type="text" [(ngModel)]="category.slug" name="slug" class="form-control" required
            placeholder="ten-danh-muc" />
          <small class="form-hint">Slug sẽ được tự động tạo từ tên danh mục</small>
        </div>

        <!-- Mô tả -->
        <div class="form-group">
          <label>Mô tả</label>
          <textarea [(ngModel)]="category.description" name="description" class="form-control" rows="3"
            placeholder="Nhập mô tả cho danh mục"></textarea>
        </div>

        <!-- Upload ảnh -->
        <div class="form-group">
          <label>Ảnh danh mục</label>

          <!-- Image Preview -->
          <div class="image-preview-container" *ngIf="imagePreview">
            <img [src]="imagePreview | proxyImage" alt="Preview" class="image-preview" />
            <button type="button" class="btn-remove-image" (click)="removeImage()" title="Xóa ảnh">
              <fa-icon [icon]="faTrash"></fa-icon>
            </button>
          </div>

          <!-- Upload Area -->
          <div class="upload-area" *ngIf="!imagePreview" [class.dragging]="isDragging" (click)="triggerFileInput()"
            (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
            <fa-icon [icon]="faCloudArrowUp" size="3x" class="upload-icon"></fa-icon>
            <p class="upload-text">Kéo thả ảnh vào đây hoặc click để chọn</p>
            <p class="upload-hint">Hỗ trợ: JPG, PNG, GIF (tối đa 5MB)</p>
          </div>

          <!-- Hidden File Input -->
          <input type="file" id="fileInput" accept="image/*" (change)="onFileSelected($event)" style="display: none" />
        </div>

        <!-- Danh mục cha và Thứ tự -->
        <div class="form-row">
          <div class="form-group">
            <label>Danh mục cha</label>
            <select [(ngModel)]="category.parentCategoryId" name="parentCategoryId" class="form-control">
              <option [ngValue]="undefined">-- Danh mục gốc --</option>
              <option *ngFor="let cat of allCategories" [ngValue]="cat.categoryId">
                {{ cat.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Thứ tự hiển thị <span class="required">*</span></label>
            <input type="number" [(ngModel)]="category.displayOrder" name="displayOrder" class="form-control" min="0"
              required />
          </div>
        </div>

        <!-- Meta Title và Meta Description -->
        <div class="form-row">
          <div class="form-group">
            <label>Meta Title</label>
            <input type="text" [(ngModel)]="category.metaTitle" name="metaTitle" class="form-control"
              placeholder="SEO Title" />
          </div>

          <div class="form-group">
            <label>Meta Description</label>
            <input type="text" [(ngModel)]="category.metaDescription" name="metaDescription" class="form-control"
              placeholder="SEO Description" />
          </div>
        </div>

        <!-- Trạng thái -->
        <div class="form-group">
          <label>Trạng thái <span class="required">*</span></label>
          <select [(ngModel)]="category.status" name="status" class="form-control" required>
            <option [ngValue]="1">Hoạt động</option>
            <option [ngValue]="0">Tạm ẩn</option>
          </select>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" (click)="onClose()">Hủy</button>
      <button class="btn btn-primary" type="button" (click)="onSave()">
        {{ mode === 'add' ? 'Thêm' : 'Cập nhật' }}
      </button>
    </div>
  </div>
</div>