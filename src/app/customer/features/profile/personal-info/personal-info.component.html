<div class="personal-info">
  <!-- Toast for notifications -->
  <p-toast />
  
  <!-- Confirm Dialog -->
  <p-confirmDialog />

  <p-card>
    <ng-template pTemplate="header">
      <div class="card-header">
        <div>
          <h2 class="section-title">Thông tin cá nhân</h2>
          <p class="section-subtitle">Quản lý thông tin cá nhân của bạn</p>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <p-progressSpinner 
          styleClass="w-4rem h-4rem" 
          strokeWidth="4" 
          animationDuration="1s" />
        <p class="loading-text">Đang tải thông tin...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="!isLoading && errorMessage" class="error-state">
        <p-message severity="error" [text]="errorMessage" />
        <p-button 
          label="Thử lại" 
          icon="pi pi-refresh" 
          (onClick)="loadUserInfo()" 
          styleClass="p-button-outlined mt-3" />
      </div>

      <!-- Content -->
      <div *ngIf="!isLoading && !errorMessage" class="info-content">
        <div class="info-grid">
          <!-- Họ -->
          <div class="info-field">
            <label class="field-label">Họ</label>
            <div class="field-value">{{ userInfo.lastName || 'Chưa cập nhật' }}</div>
          </div>

          <!-- Tên -->
          <div class="info-field">
            <label class="field-label">Tên</label>
            <div class="field-value">{{ userInfo.firstName || 'Chưa cập nhật' }}</div>
          </div>

          <!-- Email -->
          <div class="info-field">
            <label class="field-label">
              Email
            </label>
            <div class="field-value-with-badge">
              <span>{{ userInfo.email || 'Chưa cập nhật' }}</span>
              <p-tag 
                *ngIf="userInfo.emailVerified" 
                severity="success" 
                icon="pi pi-check" 
                value="Đã xác thực" />
              <p-tag 
                *ngIf="!userInfo.emailVerified" 
                severity="warn" 
                icon="pi pi-exclamation-triangle" 
                value="Chưa xác thực" />
            </div>
          </div>

          <!-- Số điện thoại -->
          <div class="info-field">
            <label class="field-label">
              Số điện thoại
            </label>
            <div class="field-value-with-badge">
              <span>{{ userInfo.phone || 'Chưa cập nhật' }}</span>
              <p-tag 
                *ngIf="userInfo.phoneVerified" 
                severity="success" 
                icon="pi pi-check" 
                value="Đã xác thực" />
              <p-tag 
                *ngIf="!userInfo.phoneVerified" 
                severity="warn" 
                icon="pi pi-exclamation-triangle" 
                value="Chưa xác thực" />
            </div>
          </div>

          <!-- Ngày sinh -->
          <div class="info-field">
            <label class="field-label">Ngày sinh</label>
            <div class="field-value">{{ userInfo.dateOfBirth || 'Chưa cập nhật' }}</div>
          </div>

          <!-- Trạng thái -->
          <div class="info-field">
            <label class="field-label">Trạng thái tài khoản</label>
            <div class="field-value">
              <p-tag 
                [severity]="getStatusSeverity()" 
                [value]="getStatusText()" />
            </div>
          </div>
        </div>

        <p-divider />

        <div class="action-buttons">
          <p-button 
            label="Chỉnh sửa thông tin" 
            icon="pi pi-pencil" 
            (onClick)="openEditDialog()" 
            styleClass="p-button-primary" />
          <p-button 
            label="Xóa tài khoản" 
            icon="pi pi-trash" 
            (onClick)="deleteAccount()" 
            severity="danger"
            styleClass="p-button-outlined" />
        </div>
      </div>
    </ng-template>
  </p-card>

  <!-- Edit Dialog -->
  <p-dialog 
    [(visible)]="displayEditDialog" 
    [modal]="true" 
    [style]="{width: '600px'}"
    [contentStyle]="{'overflow': 'visible'}"
    [draggable]="false"
    [resizable]="false">
    <ng-template pTemplate="header">
      <h3>Chỉnh sửa thông tin cá nhân</h3>
    </ng-template>

    <ng-template pTemplate="content">
      <div class="edit-form">
        <div class="form-grid">
          <!-- Họ -->
          <div class="form-field">
            <label for="lastName" class="block mb-2">Họ <span class="text-red-500">*</span></label>
            <input 
              pInputText 
              id="lastName" 
              [(ngModel)]="editForm.lastName" 
              class="w-full" 
              placeholder="Nhập họ" />
          </div>

          <!-- Tên -->
          <div class="form-field">
            <label for="firstName" class="block mb-2">Tên <span class="text-red-500">*</span></label>
            <input 
              pInputText 
              id="firstName" 
              [(ngModel)]="editForm.firstName" 
              class="w-full" 
              placeholder="Nhập tên" />
          </div>

          <!-- Email -->
          <div class="form-field">
            <label for="email" class="block mb-2">Email <span class="text-red-500">*</span></label>
            <input 
              pInputText 
              id="email" 
              type="email"
              [(ngModel)]="editForm.email" 
              class="w-full" 
              placeholder="Nhập email" />
          </div>

          <!-- Số điện thoại -->
          <div class="form-field">
            <label for="phone" class="block mb-2">Số điện thoại</label>
            <input 
              pInputText 
              id="phone" 
              type="tel"
              [(ngModel)]="editForm.phone" 
              class="w-full" 
              placeholder="Nhập số điện thoại" />
          </div>

          <!-- Ngày sinh -->
          <div class="form-field full-width">
            <label for="dateOfBirth" class="block mb-2">Ngày sinh</label>
            <p-datepicker 
              [(ngModel)]="editForm.dateOfBirth" 
              [showIcon]="true" 
              dateFormat="dd/mm/yy"
              placeholder="Chọn ngày sinh"
              styleClass="w-full"
              appendTo="body" />
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <p-button 
        label="Hủy" 
        icon="pi pi-times" 
        (onClick)="displayEditDialog = false" 
        styleClass="p-button-text" />
      <p-button 
        label="Lưu thay đổi" 
        icon="pi pi-check" 
        (onClick)="saveChanges()" 
        [loading]="isLoading" />
    </ng-template>
  </p-dialog>
</div>
