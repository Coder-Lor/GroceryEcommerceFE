<p-toast />
<p-confirmDialog />

<div class="user-address">
  <div class="header">
    <div>
      <h2 class="section-title">Địa chỉ của tôi</h2>
      <p class="section-subtitle">Quản lý địa chỉ giao hàng</p>
    </div>
    <p-button
      label="Thêm địa chỉ mới"
      icon="pi pi-plus"
      (onClick)="addNewAddress()"
      [disabled]="isLoading"
    />
  </div>

  <div class="loading-container" *ngIf="isLoading">
    <p-progressSpinner
      styleClass="w-4rem h-4rem"
      strokeWidth="4"
      animationDuration="1s"
    />
  </div>

  <div class="address-list" *ngIf="!isLoading">
    <div *ngIf="addresses.length === 0" class="empty-state">
      <i class="pi pi-map-marker" style="font-size: 3rem; color: var(--text-color-secondary)"></i>
      <p>Bạn chưa có địa chỉ nào. Hãy thêm địa chỉ mới!</p>
    </div>

    <p-card *ngFor="let address of addresses" styleClass="address-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <h3>{{ address.addressLine1 }}</h3>
          <p-tag *ngIf="address.isDefault" value="Mặc định" severity="success" />
        </div>
      </ng-template>

      <div class="address-details">
        <div class="detail-item">
          <i class="pi pi-map-marker"></i>
          <span>
            {{ address.addressLine1 }}
            <span *ngIf="address.addressLine2">, {{ address.addressLine2 }}</span>
          </span>
        </div>
        <div class="detail-item">
          <i class="pi pi-building"></i>
          <span>{{ address.city }}, {{ address.state }} {{ address.zipCode }}</span>
        </div>
        <div class="detail-item">
          <i class="pi pi-globe"></i>
          <span>{{ address.country }}</span>
        </div>
      </div>

      <ng-template pTemplate="footer">
        <div class="card-actions">
          <p-button
            label="Chỉnh sửa"
            icon="pi pi-pencil"
            [text]="true"
            (onClick)="editAddress(address)"
            [disabled]="isLoading"
          />
          <p-button
            label="Xóa"
            icon="pi pi-trash"
            [text]="true"
            severity="danger"
            (onClick)="deleteAddress(address)"
            [disabled]="isLoading"
          />
          <p-button
            *ngIf="!address.isDefault"
            label="Đặt làm mặc định"
            icon="pi pi-star"
            [text]="true"
            severity="secondary"
            (onClick)="setDefaultAddress(address)"
            [disabled]="isLoading"
          />
        </div>
      </ng-template>
    </p-card>
  </div>
</div>

<app-address-form-modal
  [address]="selectedAddress"
  [isOpen]="isModalOpen"
  (close)="onCloseModal()"
  (save)="onSaveAddress($event)"
/>
