<div class="homepage">
  @defer {
  <section class="hero-slider container position-relative mb-4">
    <swiper-container class="hero-swiper" [class.swiper-ready]="isHeroSwiperReady" autoplay-delay="4000" loop="true"
      pagination="false" navigation="true">
      <swiper-slide *ngFor="let slide of heroSlides">
        <div class="hero-slide position-relative overflow-hidden">
          <img [src]="slide.image1" class="w-100 h-100 rounded-4 overflow-hidden object-fit-cover" />
          <img [src]="slide.image2" class="w-100 h-100 rounded-4 overflow-hidden object-fit-cover" />
        </div>
      </swiper-slide>
    </swiper-container>
  </section>
  } @placeholder(minimum 1200ms) {
  <section class="hero-slider container position-relative mb-4">
    <div class="row g-3">
      <div class="col-12 col-lg-8">
        <p-skeleton width="100%" height="260px" styleClass="rounded-4"></p-skeleton>
      </div>
      <div class="col-12 col-lg-4 d-flex flex-column gap-3">
        <p-skeleton width="100%" height="120px" styleClass="rounded-4"></p-skeleton>
        <p-skeleton width="100%" height="120px" styleClass="rounded-4"></p-skeleton>
      </div>
    </div>
  </section>
  }

  <!-- Categories -->
  <section class="categories container py-2 mb-3">
    <h3 class="section-title fw-bold mb-4">DANH MỤC SẢN PHẨM</h3>

    @if (isLoadingCategories) {
    <div class="row g-3">
      @for (item of categorySkeletonItems; track $index) {
      <div class="col-6 col-md-4 col-lg-2">
        <div class="category-card text-center">
          <p-skeleton width="100%" height="100px" styleClass="category-img"></p-skeleton>
          <p-skeleton width="80%" height="1rem" styleClass="mt-2 mx-auto"></p-skeleton>
        </div>
      </div>
      }
    </div>
    } @else {
    <swiper-container slides-per-view="6" space-between="20" navigation="true" loop="false" class="category-swiper">
      @for (item of categories; track $index) {
      <swiper-slide (click)="navigationToCategory(item)" class="category-slide">
        <div class="category-card text-center">
          <img [src]="item.imageUrl" [alt]="item.name" class="category-img" />
          <p class="category-name mt-2">{{ item.name }}</p>
        </div>
      </swiper-slide>
      }
    </swiper-container>
    }
  </section>

  <!-- Flash sale -->
  <section class="flash-sale container py-5">
    <div class="flash-sale-header d-flex justify-content-between align-items-center mb-4">
      <div class="d-flex align-items-center gap-3">
        <h3 class="section-title fw-bold mb-0">Flash Sale</h3>
        <countdown class="flash-timer" [config]="countdownConfig" (event)="onCountdownEvent($event)"></countdown>
      </div>
      <a class="see-all" href="#">Xem tất cả</a>
    </div>

    @if (isLoadingFlashSale || flashSaleProducts.length === 0) {
    <div class="flash-sale-skeletons row g-3">
      @for (item of flashSaleSkeletonItems; track $index) {
      <div class="col-6 col-md-4 col-lg-2">
        <div class="product-card p-3 h-100">
          <p-skeleton width="100%" height="160px" styleClass="mb-3 d-block"></p-skeleton>
          <p-skeleton width="70%" height="1rem" styleClass="mb-2 d-block"></p-skeleton>
          <p-skeleton width="50%" height="1rem" styleClass="d-block"></p-skeleton>
        </div>
      </div>
      }
    </div>
    } @else {
    <swiper-container slides-per-view="6" space-between="20" navigation="true" loop="true" autoplay-delay="5000"
      autoplay-disable-on-interaction="false" class="flash-sale-swiper">
      <swiper-slide *ngFor="let product of flashSaleProducts" class="flash-sale-slide">
        <div class="product-card" (click)="navigateToProductDetail(product.slug)">
          <div class="discount-badge">-{{ getDiscountPercent(product) }}%</div>
          <div class="discount-badge">-{{ getDiscountPercent(product) }}%</div>
          <div class="product-image">
            <img [src]="product.primaryImageUrl || '/images/no-image.png'" [alt]="product.name || 'Sản phẩm'"
              onerror="this.src='/images/no-image.png'" />
          </div>
          <div class="sale-status">
            <div class="progress-bar">
              <div class="progress" [style.width.%]="getProductProgress(product)"></div>
              <div class="progress" [style.width.%]="getProductProgress(product)"></div>
            </div>
            <p class="price-text">
              {{
              product.cost | currency : 'VND' : 'symbol' : '1.0-0'
              }}
            </p>
            <p class="status-text">
              {{
              product.stockQuantity && product.stockQuantity > 50 ? 'Vừa mới bán' : 'Sắp hết hàng'
              }}
            </p>
          </div>
        </div>
      </swiper-slide>
    </swiper-container>
    }
  </section>

  <!-- BRANDS -->
  <section class="brands container py-5" style="margin-top: 30px">
    <h3 class="section-title fw-bold mb-4">THƯƠNG HIỆU NỔI BẬT</h3>

    <swiper-container slides-per-view="6" space-between="20" navigation="true" loop="true" class="brands-swiper">
      <swiper-slide *ngFor="let brand of brands" class="brand-slide">
        <div class="brand-card">
          <img [src]="brand.logo" [alt]="brand.name" class="brand-logo" />
        </div>
      </swiper-slide>
    </swiper-container>
  </section>

  <!-- Product list -->
  <div class="product-list container mt-4">
    @if (isLoading && products.length === 0) {
    <div class="row g-4">
      @for (item of productSkeletonItems; track $index) {
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="product-card h-100">
          <p-skeleton width="100%" height="220px" styleClass="mb-3"></p-skeleton>
          <p-skeleton width="80%" height="1rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton width="60%" height="1rem"></p-skeleton>
        </div>
      </div>
      }
    </div>
    } @else {
    <p-dataview #dv [value]="products" [layout]="layout">
      <!-- Header -->
      <!-- GRID layout -->
      <ng-template #grid let-items>
        <div class="row g-4">
          @for (item of products; track $index) {
          <div class="col-12 col-sm-6 col-lg-3">
            <product-card [product]="item" [layout]="'grid'" [getSeverity]="getSeverity.bind(this)"></product-card>
          </div>
          }
        </div>
      </ng-template>
    </p-dataview>
    }
  </div>


  <div class="container paginator mt-4">
    <div class="row d-flex justify-content-center">
      <button class="btn-see-more" (click)="loadMore()">
        {{ isLoading ? 'Đang tải...' : products.length >= totalCount ? 'Đã tải hết' : 'XEM THÊM' }}
      </button>
    </div>
  </div>

  <section class="policy-section container my-5">
    <!-- Header -->
    <div class="text-center mb-5">
      <h3 class="fw-bold mb-2">Chính sách & cam kết của chúng tôi</h3>
      <p class="text-muted">
        Mang đến trải nghiệm mua sắm an toàn, nhanh chóng và tiện lợi cho bạn
      </p>
    </div>

    <!-- Chính sách -->
    <div class="row g-4 justify-content-center">
      <!-- Hàng đầu: 3 chính sách -->
      <div class="col-12 col-md-4" *ngFor="let policy of policies.slice(0, 3)">
        <div class="policy-card text-center p-4">
          <div class="icon mb-3">
            <i [class]="policy.icon"></i>
          </div>
          <h6 class="fw-bold mb-2">{{ policy.title }}</h6>
          <p class="text-muted small mb-0">{{ policy.desc }}</p>
        </div>
      </div>

      <!-- Hàng thứ 2: 2 chính sách -->
      <div class="col-12 col-md-4 col-lg-3" *ngFor="let policy of policies.slice(3)">
        <div class="policy-card text-center p-4 h-100">
          <div class="icon mb-3">
            <i [class]="policy.icon"></i>
          </div>
          <h6 class="fw-bold mb-2">{{ policy.title }}</h6>
          <p class="text-muted small mb-0">{{ policy.desc }}</p>
        </div>
      </div>
    </div>
  </section>
</div>